{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useContext, useRef, useEffect } from 'react';\nimport useInput from 'client/hooks/useInput';\nimport { UserContext } from 'pages/index';\nimport Router from 'next/router';\nimport styles from '../styles/LoginForm.module.css';\n\nfunction LoginForm() {\n  _s();\n\n  var inputRef = useRef(null);\n\n  var _useInput = useInput(''),\n      _useInput2 = _slicedToArray(_useInput, 3),\n      email = _useInput2[0],\n      bindEmail = _useInput2[1],\n      resetEmail = _useInput2[2];\n\n  var _useInput3 = useInput(''),\n      _useInput4 = _slicedToArray(_useInput3, 3),\n      pass = _useInput4[0],\n      bindPass = _useInput4[1],\n      resetPass = _useInput4[2];\n\n  var userContext = useContext(UserContext);\n  var toeknUrl = process.env.getTokenUrl;\n  var localStorageRef = localStorage.getItem('userInfo');\n\n  var submitHandler = function submitHandler(e) {\n    // ----------fetch version get token---------------\n    var requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        username: email,\n        password: pass\n      })\n    };\n    fetch(toeknUrl, requestOptions).then(function (resf) {\n      return resf.json();\n    }).then(function (data) {\n      if (data.token) {\n        // success login\n        console.log(data);\n        userContext.loginDispatch({\n          type: 'login',\n          token: data.token,\n          mail: data.user_display_name,\n          pass: pass,\n          id: data.id\n        });\n        localStorage.setItem('userInfo', JSON.stringify({\n          name: data.user_display_name,\n          token: data.token\n        }));\n        Router.push('/');\n      } else {\n        // wrong information\n        userContext.loginDispatch({\n          type: 'error',\n          error: 'wrong email or password'\n        });\n        resetEmail('');\n        resetPass('');\n      }\n    })[\"catch\"](function (err) {\n      // other errors\n      userContext.loginDispatch({\n        type: 'error',\n        error: error\n      });\n    }); // ------------------------------------------------\n\n    e.preventDefault();\n  };\n\n  useEffect(function () {\n    inputRef.current.focus();\n  }, []);\n\n  if (localStorageRef) {\n    var requestOptions1 = {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer ' + localStorageRef.token\n      } // body: { username: email, password:pass }\n      // body: formData\n\n    };\n    fetch('http://localhost/wp-json/wp/v2/users/me', requestOptions1) // test if token can be used on other api\n    .then(function (resf1) {\n      return resf1.json();\n    }) // necessary!\n    .then(function (data1) {\n      return console.log(data1);\n    })[\"catch\"](function (err) {\n      return console.log(err);\n    });\n  } else {\n    return __jsx(\"div\", {\n      className: styles.formConatainer\n    }, __jsx(\"form\", {\n      onSubmit: submitHandler,\n      className: styles.form\n    }, __jsx(\"div\", {\n      className: styles.formOption\n    }, __jsx(\"label\", {\n      className: styles.formLabel\n    }, \"E-mail: \"), __jsx(\"input\", _extends({}, bindEmail, {\n      type: \"text\",\n      className: styles.formTextarea,\n      ref: inputRef\n    }))), __jsx(\"div\", {\n      className: styles.formOption\n    }, __jsx(\"label\", {\n      className: styles.formLabel\n    }, \"Password: \"), __jsx(\"input\", _extends({}, bindPass, {\n      type: \"password\",\n      className: styles.formTextarea\n    }))), __jsx(\"div\", {\n      style: {\n        height: '10px',\n        textAlign: 'center'\n      }\n    }, userContext.loginState.error && !email && __jsx(\"span\", {\n      style: {\n        color: 'red'\n      }\n    }, \"Wrong email or password\")), __jsx(\"button\", {\n      className: styles.formSubmit\n    }, \"Submit\")));\n  }\n}\n\n_s(LoginForm, \"+NcP1o0pE0sJ8eozpdaSf4h0G7c=\", false, function () {\n  return [useInput, useInput];\n});\n\n_c = LoginForm;\nexport default LoginForm;\n\nvar _c;\n\n$RefreshReg$(_c, \"LoginForm\");","map":{"version":3,"sources":["/Users/jtweng/Desktop/record/OSU/mac/practice/docker/test/client/components/LoginForm.js"],"names":["React","useContext","useRef","useEffect","useInput","UserContext","Router","styles","LoginForm","inputRef","email","bindEmail","resetEmail","pass","bindPass","resetPass","userContext","toeknUrl","process","env","getTokenUrl","localStorageRef","localStorage","getItem","submitHandler","e","requestOptions","method","headers","body","JSON","stringify","username","password","fetch","then","resf","json","data","token","console","log","loginDispatch","type","mail","user_display_name","id","setItem","name","push","error","err","preventDefault","current","focus","requestOptions1","resf1","data1","formConatainer","form","formOption","formLabel","formTextarea","height","textAlign","loginState","color","formSubmit"],"mappings":"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","sourcesContent":["import React,{useContext, useRef, useEffect} from 'react'\nimport useInput from 'client/hooks/useInput'\nimport {UserContext} from 'pages/index'\nimport Router from 'next/router'\nimport styles from '../styles/LoginForm.module.css'\n\nfunction LoginForm() {\n  const inputRef = useRef(null)\n  const [email, bindEmail, resetEmail] = useInput('')\n  const [pass, bindPass, resetPass] = useInput('')\n  const userContext = useContext(UserContext)\n  const toeknUrl = process.env.getTokenUrl\n  const localStorageRef = localStorage.getItem('userInfo')\n\n  const submitHandler = e => {\n    // ----------fetch version get token---------------\n    const requestOptions = {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ username: email, password:pass })\n    };\n    fetch(toeknUrl, requestOptions)\n    .then(resf => resf.json())\n    .then(data => {\n      if(data.token){\n        // success login\n        console.log(data)\n        userContext.loginDispatch({type:'login', token:data.token, mail:data.user_display_name, pass:pass, id:data.id})\n        localStorage.setItem('userInfo', JSON.stringify({name:data.user_display_name, token:data.token}))\n        Router.push('/')\n      } else {\n        // wrong information\n        userContext.loginDispatch({type:'error', error:'wrong email or password'})\n        resetEmail('')\n        resetPass('')\n      }\n    })\n    .catch(err => {\n      // other errors\n      userContext.loginDispatch({type:'error', error:error})\n    })\n    // ------------------------------------------------\n    e.preventDefault()\n  }\n\n  useEffect(() =>{\n    inputRef.current.focus()\n  },[])\n\n  if(localStorageRef){\n    const requestOptions1 = {\n      method: 'GET',\n      headers: { 'Authorization': 'Bearer ' + localStorageRef.token },\n      // body: { username: email, password:pass }\n        // body: formData\n      };\n    fetch('http://localhost/wp-json/wp/v2/users/me',requestOptions1) \n    // test if token can be used on other api\n      .then(resf1 => resf1.json()) // necessary!\n      .then(data1 => console.log(data1))\n      .catch(err  => console.log(err))\n  } else {\n    return (\n      <div className={styles.formConatainer}>\n        <form onSubmit={submitHandler} className={styles.form}>\n          \n          <div className={styles.formOption}>\n            <label className={styles.formLabel}>E-mail: </label>\n            <input {...bindEmail} type=\"text\" className={styles.formTextarea} ref={inputRef}/>\n          </div>\n          <div className={styles.formOption}>\n            <label className={styles.formLabel}>Password: </label>\n            <input {...bindPass} type=\"password\" className={styles.formTextarea}/>\n          </div>\n          <div style={{height:'10px',textAlign:'center'}}>\n            {userContext.loginState.error && !email && <span style={{color:'red'}}>Wrong email or password</span>}\n          </div>\n          <button className={styles.formSubmit}>Submit</button>\n        </form>\n      </div>\n    )}\n}\n\nexport default LoginForm\n"]},"metadata":{},"sourceType":"module"}