{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useContext, useRef, useEffect } from 'react';\nimport useInput from 'client/hooks/useInput';\nimport { UserContext } from 'pages/index';\nimport Router from 'next/router';\nimport styles from '../styles/LoginForm.module.css';\n\nfunction LoginForm() {\n  const inputRef = useRef(null);\n  const [email, bindEmail, resetEmail] = useInput('');\n  const [pass, bindPass, resetPass] = useInput('');\n  const userContext = useContext(UserContext);\n  const toeknUrl = process.env.getTokenUrl;\n\n  const submitHandler = e => {\n    // ----------fetch version get token---------------\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        username: email,\n        password: pass\n      })\n    };\n    fetch(toeknUrl, requestOptions).then(resf => resf.json()).then(data => {\n      if (data.token) {\n        // success login\n        console.log(data);\n        userContext.loginDispatch({\n          type: 'login',\n          token: data.token,\n          mail: data.user_display_name,\n          pass: pass,\n          id: data.id\n        });\n        localStorage.setItem('userInfo', JSON.stringify({\n          name: data.user_display_name,\n          token: data.token\n        }));\n        Router.push('/');\n      } else {\n        // wrong information\n        userContext.loginDispatch({\n          type: 'error',\n          error: 'wrong email or password'\n        });\n        resetEmail('');\n        resetPass('');\n      }\n    }).catch(err => {\n      // other errors\n      userContext.loginDispatch({\n        type: 'error',\n        error: error\n      });\n    }); // ------------------------------------------------\n\n    e.preventDefault();\n  };\n\n  useEffect(() => {\n    inputRef.current.focus();\n    const localStorageRef = JSON.parse(localStorage.getItem('userInfo'));\n    console.log('localStorageRef =');\n    console.log(localStorageRef.token);\n\n    if (localStorageRef) {\n      const requestOptions1 = {\n        method: 'GET',\n        headers: {\n          'Authorization': 'Bearer ' + localStorageRef.token\n        }\n      };\n      fetch('http://localhost/wp-json/wp/v2/users/me', requestOptions1) // test if token can be used on other api\n      .then(resf1 => resf1.json()) // necessary!\n      .then(data1 => {\n        userContext.loginDispatch({\n          type: 'login',\n          token: localStorageRef.token,\n          mail: data.name,\n          pass: '',\n          id: data1.id\n        });\n        Router.push('/');\n      }).catch(err => console.log(err));\n    }\n  }, []);\n  return __jsx(\"div\", {\n    className: styles.formConatainer\n  }, __jsx(\"form\", {\n    onSubmit: submitHandler,\n    className: styles.form\n  }, __jsx(\"div\", {\n    className: styles.formOption\n  }, __jsx(\"label\", {\n    className: styles.formLabel\n  }, \"E-mail: \"), __jsx(\"input\", _extends({}, bindEmail, {\n    type: \"text\",\n    className: styles.formTextarea,\n    ref: inputRef\n  }))), __jsx(\"div\", {\n    className: styles.formOption\n  }, __jsx(\"label\", {\n    className: styles.formLabel\n  }, \"Password: \"), __jsx(\"input\", _extends({}, bindPass, {\n    type: \"password\",\n    className: styles.formTextarea\n  }))), __jsx(\"div\", {\n    style: {\n      height: '10px',\n      textAlign: 'center'\n    }\n  }, userContext.loginState.error && !email && __jsx(\"span\", {\n    style: {\n      color: 'red'\n    }\n  }, \"Wrong email or password\")), __jsx(\"button\", {\n    className: styles.formSubmit\n  }, \"Submit\")));\n}\n\nexport default LoginForm;","map":{"version":3,"sources":["/Users/jtweng/Desktop/record/OSU/mac/practice/docker/test/client/components/LoginForm.js"],"names":["React","useContext","useRef","useEffect","useInput","UserContext","Router","styles","LoginForm","inputRef","email","bindEmail","resetEmail","pass","bindPass","resetPass","userContext","toeknUrl","process","env","getTokenUrl","submitHandler","e","requestOptions","method","headers","body","JSON","stringify","username","password","fetch","then","resf","json","data","token","console","log","loginDispatch","type","mail","user_display_name","id","localStorage","setItem","name","push","error","catch","err","preventDefault","current","focus","localStorageRef","parse","getItem","requestOptions1","resf1","data1","formConatainer","form","formOption","formLabel","formTextarea","height","textAlign","loginState","color","formSubmit"],"mappings":"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","sourcesContent":["import React,{useContext, useRef, useEffect} from 'react'\nimport useInput from 'client/hooks/useInput'\nimport {UserContext} from 'pages/index'\nimport Router from 'next/router'\nimport styles from '../styles/LoginForm.module.css'\n\nfunction LoginForm() {\n  const inputRef = useRef(null)\n  const [email, bindEmail, resetEmail] = useInput('')\n  const [pass, bindPass, resetPass] = useInput('')\n  const userContext = useContext(UserContext)\n  const toeknUrl = process.env.getTokenUrl\n  \n\n  const submitHandler = e => {\n    // ----------fetch version get token---------------\n    const requestOptions = {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ username: email, password:pass })\n    };\n    fetch(toeknUrl, requestOptions)\n    .then(resf => resf.json())\n    .then(data => {\n      if(data.token){\n        // success login\n        console.log(data)\n        userContext.loginDispatch({type:'login', token:data.token, mail:data.user_display_name, pass:pass, id:data.id})\n        localStorage.setItem('userInfo', JSON.stringify({name:data.user_display_name, token:data.token}))\n        Router.push('/')\n      } else {\n        // wrong information\n        userContext.loginDispatch({type:'error', error:'wrong email or password'})\n        resetEmail('')\n        resetPass('')\n      }\n    })\n    .catch(err => {\n      // other errors\n      userContext.loginDispatch({type:'error', error:error})\n    })\n    // ------------------------------------------------\n    e.preventDefault()\n  }\n\n  useEffect(() =>{\n    inputRef.current.focus()\n    const localStorageRef = JSON.parse(localStorage.getItem('userInfo'))\n    console.log('localStorageRef =')\n    console.log(localStorageRef.token)\n    if(localStorageRef){\n      const requestOptions1 = {\n        method: 'GET',\n        headers: { 'Authorization': 'Bearer ' + localStorageRef.token },\n        };\n      fetch('http://localhost/wp-json/wp/v2/users/me',requestOptions1) \n      // test if token can be used on other api\n        .then(resf1 => resf1.json()) // necessary!\n        .then(data1 => {\n          userContext.loginDispatch({\n            type:'login', \n            token:localStorageRef.token, \n            mail:data.name, \n            pass:'', \n            id:data1.id})\n            Router.push('/')\n        })\n        .catch(err  => console.log(err))\n    } \n  },[])\n\n  return (\n    <div className={styles.formConatainer}>\n      <form onSubmit={submitHandler} className={styles.form}>\n        \n        <div className={styles.formOption}>\n          <label className={styles.formLabel}>E-mail: </label>\n          <input {...bindEmail} type=\"text\" className={styles.formTextarea} ref={inputRef}/>\n        </div>\n        <div className={styles.formOption}>\n          <label className={styles.formLabel}>Password: </label>\n          <input {...bindPass} type=\"password\" className={styles.formTextarea}/>\n        </div>\n        <div style={{height:'10px',textAlign:'center'}}>\n          {userContext.loginState.error && !email && <span style={{color:'red'}}>Wrong email or password</span>}\n        </div>\n        <button className={styles.formSubmit}>Submit</button>\n      </form>\n    </div>\n  )\n}\n\nexport default LoginForm\n"]},"metadata":{},"sourceType":"module"}