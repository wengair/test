{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useContext, useRef, useEffect } from 'react';\nimport styles from 'client/styles/Edit.module.css';\nimport { UserContext } from 'pages/_app';\nimport useInput from 'client/hooks/useInput';\n\nfunction Edit({\n  post\n}) {\n  const inputRef = useRef(null);\n  const userContext = useContext(UserContext);\n  const [title, bindTitle, resetTitle] = useInput('');\n  const [content, bindContent, resetContent] = useInput('');\n  const postsUrl = process.env.getPostsUrl;\n  console.log('in edit');\n  console.log(userContext.loginState); // console.log('post=')\n  // console.log(post)\n\n  const submitHandler = e => {\n    e.preventDefault();\n    const localStorageRef = JSON.parse(localStorage.getItem('userInfo'));\n    const id = Number(window.location.pathname.split(\"/\")[2]);\n    const updatePostUrl = postsUrl + `/${id}`; // ----------fetch version get token---------------\n\n    const requestOptions = {\n      method: 'POST',\n      headers: {\n        'Authorization': 'Bearer ' + localStorageRef.token\n      },\n      body: JSON.stringify({\n        title: title,\n        content: content\n      })\n    };\n    fetch(postsUrl, requestOptions).then(resf => resf.json()).then(data => {\n      if (data.token) {\n        // success login\n        console.log(data);\n        userContext.loginDispatch({\n          type: 'login',\n          token: data.token,\n          mail: data.user_display_name,\n          pass: pass,\n          id: data.id\n        });\n        localStorage.setItem('userInfo', JSON.stringify({\n          name: data.user_display_name,\n          token: data.token\n        }));\n        Router.push('/');\n      } else {\n        // wrong information\n        userContext.loginDispatch({\n          type: 'error',\n          error: 'wrong email or password'\n        });\n        resetEmail('');\n        resetPass('');\n      }\n    }).catch(err => {\n      // other errors\n      userContext.loginDispatch({\n        type: 'error',\n        error: err\n      });\n    }); // ------------------------------------------------\n\n    console.log('haha');\n  };\n\n  useEffect(() => {\n    const id = Number(window.location.pathname.split(\"/\")[2]); // console.log(window.location)\n    // console.log(id)\n    // console.log(postsUrl+`/${id}`)\n\n    fetch(postsUrl + `/${id}`).then(res => res.json()).then(data => {\n      // console.log(data)\n      resetTitle(data.slug);\n      resetContent(data.excerpt.rendered); // content = data.excerpt.rendered\n    }).catch(err => console.log(err));\n    return () => {// cleanup\n    };\n  }, [title, content]);\n  return __jsx(\"div\", {\n    className: \"formConatainer\"\n  }, __jsx(\"form\", {\n    onSubmit: submitHandler,\n    className: styles.form\n  }, __jsx(\"div\", {\n    className: styles.formOption\n  }, __jsx(\"label\", {\n    className: styles.formLabel\n  }, \"Title: \"), __jsx(\"input\", _extends({}, bindTitle, {\n    name: \"title\",\n    type: \"text\",\n    className: styles.formText,\n    ref: inputRef\n  }))), __jsx(\"div\", {\n    className: styles.formOption\n  }, __jsx(\"label\", {\n    className: styles.formLabel\n  }, \"Content: \"), __jsx(\"textarea\", _extends({}, bindContent, {\n    name: \"content\",\n    type: \"textarea\",\n    className: styles.formTextArea\n  }))), __jsx(\"button\", {\n    className: styles.formSubmit\n  }, \"Submit\")));\n}\n\nexport default Edit;","map":{"version":3,"sources":["/Users/jtweng/Desktop/record/OSU/mac/practice/docker/test/pages/posts/[id]/Edit.js"],"names":["React","useContext","useRef","useEffect","styles","UserContext","useInput","Edit","post","inputRef","userContext","title","bindTitle","resetTitle","content","bindContent","resetContent","postsUrl","process","env","getPostsUrl","console","log","loginState","submitHandler","e","preventDefault","localStorageRef","JSON","parse","localStorage","getItem","id","Number","window","location","pathname","split","updatePostUrl","requestOptions","method","headers","token","body","stringify","fetch","then","resf","json","data","loginDispatch","type","mail","user_display_name","pass","setItem","name","Router","push","error","resetEmail","resetPass","catch","err","res","slug","excerpt","rendered","form","formOption","formLabel","formText","formTextArea","formSubmit"],"mappings":";;;;AAAA,OAAOA,KAAP,IAAeC,UAAf,EAA2BC,MAA3B,EAAkCC,SAAlC,QAAkD,OAAlD;AACA,OAAOC,MAAP,MAAmB,+BAAnB;AACA,SAAQC,WAAR,QAA0B,YAA1B;AACA,OAAOC,QAAP,MAAqB,uBAArB;;AAEA,SAASC,IAAT,CAAc;AAACC,EAAAA;AAAD,CAAd,EAAsB;AACpB,QAAMC,QAAQ,GAAGP,MAAM,CAAC,IAAD,CAAvB;AACA,QAAMQ,WAAW,GAAGT,UAAU,CAACI,WAAD,CAA9B;AACA,QAAM,CAACM,KAAD,EAAQC,SAAR,EAAmBC,UAAnB,IAAiCP,QAAQ,CAAC,EAAD,CAA/C;AACA,QAAM,CAACQ,OAAD,EAAUC,WAAV,EAAuBC,YAAvB,IAAuCV,QAAQ,CAAC,EAAD,CAArD;AACA,QAAMW,QAAQ,GAAGC,OAAO,CAACC,GAAR,CAAYC,WAA7B;AAEAC,EAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AACAD,EAAAA,OAAO,CAACC,GAAR,CAAYZ,WAAW,CAACa,UAAxB,EARoB,CAUpB;AACA;;AAEA,QAAMC,aAAa,GAAGC,CAAC,IAAI;AACzBA,IAAAA,CAAC,CAACC,cAAF;AACA,UAAMC,eAAe,GAAGC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAX,CAAxB;AACA,UAAMC,EAAE,GAAGC,MAAM,CAACC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,CAAyBC,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAAD,CAAjB;AACA,UAAMC,aAAa,GAAGrB,QAAQ,GAAE,IAAGe,EAAG,EAAtC,CAJyB,CAKzB;;AACA,UAAMO,cAAc,GAAG;AACrBC,MAAAA,MAAM,EAAE,MADa;AAErBC,MAAAA,OAAO,EAAE;AAAE,yBAAiB,YAAYd,eAAe,CAACe;AAA/C,OAFY;AAGrBC,MAAAA,IAAI,EAAEf,IAAI,CAACgB,SAAL,CAAe;AAAEjC,QAAAA,KAAK,EAAEA,KAAT;AAAgBG,QAAAA,OAAO,EAACA;AAAxB,OAAf;AAHe,KAAvB;AAKA+B,IAAAA,KAAK,CAAC5B,QAAD,EAAWsB,cAAX,CAAL,CACCO,IADD,CACMC,IAAI,IAAIA,IAAI,CAACC,IAAL,EADd,EAECF,IAFD,CAEMG,IAAI,IAAI;AACZ,UAAGA,IAAI,CAACP,KAAR,EAAc;AACZ;AACArB,QAAAA,OAAO,CAACC,GAAR,CAAY2B,IAAZ;AACAvC,QAAAA,WAAW,CAACwC,aAAZ,CAA0B;AAACC,UAAAA,IAAI,EAAC,OAAN;AAAeT,UAAAA,KAAK,EAACO,IAAI,CAACP,KAA1B;AAAiCU,UAAAA,IAAI,EAACH,IAAI,CAACI,iBAA3C;AAA8DC,UAAAA,IAAI,EAACA,IAAnE;AAAyEtB,UAAAA,EAAE,EAACiB,IAAI,CAACjB;AAAjF,SAA1B;AACAF,QAAAA,YAAY,CAACyB,OAAb,CAAqB,UAArB,EAAiC3B,IAAI,CAACgB,SAAL,CAAe;AAACY,UAAAA,IAAI,EAACP,IAAI,CAACI,iBAAX;AAA8BX,UAAAA,KAAK,EAACO,IAAI,CAACP;AAAzC,SAAf,CAAjC;AACAe,QAAAA,MAAM,CAACC,IAAP,CAAY,GAAZ;AACD,OAND,MAMO;AACL;AACAhD,QAAAA,WAAW,CAACwC,aAAZ,CAA0B;AAACC,UAAAA,IAAI,EAAC,OAAN;AAAeQ,UAAAA,KAAK,EAAC;AAArB,SAA1B;AACAC,QAAAA,UAAU,CAAC,EAAD,CAAV;AACAC,QAAAA,SAAS,CAAC,EAAD,CAAT;AACD;AACF,KAfD,EAgBCC,KAhBD,CAgBOC,GAAG,IAAI;AACZ;AACArD,MAAAA,WAAW,CAACwC,aAAZ,CAA0B;AAACC,QAAAA,IAAI,EAAC,OAAN;AAAeQ,QAAAA,KAAK,EAACI;AAArB,OAA1B;AACD,KAnBD,EAXyB,CA+BzB;;AACA1C,IAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;AACD,GAjCD;;AAkCAnB,EAAAA,SAAS,CAAC,MAAM;AACd,UAAM6B,EAAE,GAAGC,MAAM,CAACC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,CAAyBC,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAAD,CAAjB,CADc,CAEd;AACA;AACA;;AACAQ,IAAAA,KAAK,CAAC5B,QAAQ,GAAE,IAAGe,EAAG,EAAjB,CAAL,CACGc,IADH,CACQkB,GAAG,IAAIA,GAAG,CAAChB,IAAJ,EADf,EAEGF,IAFH,CAEQG,IAAI,IAAI;AACZ;AACApC,MAAAA,UAAU,CAACoC,IAAI,CAACgB,IAAN,CAAV;AACAjD,MAAAA,YAAY,CAACiC,IAAI,CAACiB,OAAL,CAAaC,QAAd,CAAZ,CAHY,CAIZ;AACD,KAPH,EAQGL,KARH,CAQSC,GAAG,IAAE1C,OAAO,CAACC,GAAR,CAAYyC,GAAZ,CARd;AASA,WAAO,MAAM,CACX;AACD,KAFD;AAGD,GAjBQ,EAiBN,CAACpD,KAAD,EAAOG,OAAP,CAjBM,CAAT;AAkBA,SACE;AAAK,IAAA,SAAS,EAAC;AAAf,KACE;AAAM,IAAA,QAAQ,EAAEU,aAAhB;AAA+B,IAAA,SAAS,EAAEpB,MAAM,CAACgE;AAAjD,KACE;AAAK,IAAA,SAAS,EAAEhE,MAAM,CAACiE;AAAvB,KACE;AAAO,IAAA,SAAS,EAAEjE,MAAM,CAACkE;AAAzB,eADF,EAEE,4BAAW1D,SAAX;AAAsB,IAAA,IAAI,EAAC,OAA3B;AAAmC,IAAA,IAAI,EAAC,MAAxC;AAA+C,IAAA,SAAS,EAAER,MAAM,CAACmE,QAAjE;AAA2E,IAAA,GAAG,EAAE9D;AAAhF,KAFF,CADF,EAKE;AAAK,IAAA,SAAS,EAAEL,MAAM,CAACiE;AAAvB,KACE;AAAO,IAAA,SAAS,EAAEjE,MAAM,CAACkE;AAAzB,iBADF,EAEE,+BAAcvD,WAAd;AAA2B,IAAA,IAAI,EAAC,SAAhC;AAA0C,IAAA,IAAI,EAAC,UAA/C;AAA0D,IAAA,SAAS,EAAEX,MAAM,CAACoE;AAA5E,KAFF,CALF,EAYE;AAAQ,IAAA,SAAS,EAAEpE,MAAM,CAACqE;AAA1B,cAZF,CADF,CADF;AAkBD;;AAED,eAAelE,IAAf","sourcesContent":["import React, {useContext, useRef,useEffect} from 'react'\nimport styles from 'client/styles/Edit.module.css'\nimport {UserContext} from 'pages/_app'\nimport useInput from 'client/hooks/useInput'\n\nfunction Edit({post}) {\n  const inputRef = useRef(null)\n  const userContext = useContext(UserContext)\n  const [title, bindTitle, resetTitle] = useInput('')\n  const [content, bindContent, resetContent] = useInput('')\n  const postsUrl = process.env.getPostsUrl\n  \n  console.log('in edit')\n  console.log(userContext.loginState)\n  \n  // console.log('post=')\n  // console.log(post)\n  \n  const submitHandler = e => {\n    e.preventDefault()\n    const localStorageRef = JSON.parse(localStorage.getItem('userInfo'))\n    const id = Number(window.location.pathname.split(\"/\")[2])\n    const updatePostUrl = postsUrl+`/${id}`\n    // ----------fetch version get token---------------\n    const requestOptions = {\n      method: 'POST',\n      headers: { 'Authorization': 'Bearer ' + localStorageRef.token },\n      body: JSON.stringify({ title: title, content:content })\n    };\n    fetch(postsUrl, requestOptions)\n    .then(resf => resf.json())\n    .then(data => {\n      if(data.token){\n        // success login\n        console.log(data)\n        userContext.loginDispatch({type:'login', token:data.token, mail:data.user_display_name, pass:pass, id:data.id})\n        localStorage.setItem('userInfo', JSON.stringify({name:data.user_display_name, token:data.token}))\n        Router.push('/')\n      } else {\n        // wrong information\n        userContext.loginDispatch({type:'error', error:'wrong email or password'})\n        resetEmail('')\n        resetPass('')\n      }\n    })\n    .catch(err => {\n      // other errors\n      userContext.loginDispatch({type:'error', error:err})\n    })\n    // ------------------------------------------------\n    console.log('haha')\n  }\n  useEffect(() => {\n    const id = Number(window.location.pathname.split(\"/\")[2])\n    // console.log(window.location)\n    // console.log(id)\n    // console.log(postsUrl+`/${id}`)\n    fetch(postsUrl+`/${id}`)\n      .then(res => res.json())\n      .then(data => {\n        // console.log(data)\n        resetTitle(data.slug)\n        resetContent(data.excerpt.rendered)\n        // content = data.excerpt.rendered\n      })\n      .catch(err=>console.log(err))\n    return () => {\n      // cleanup\n    }\n  }, [title,content])\n  return (\n    <div className=\"formConatainer\">\n      <form onSubmit={submitHandler} className={styles.form}>\n        <div className={styles.formOption}>\n          <label className={styles.formLabel}>Title: </label>\n          <input {...bindTitle} name='title' type=\"text\" className={styles.formText} ref={inputRef}/>\n        </div>\n        <div className={styles.formOption}>\n          <label className={styles.formLabel}>Content: </label>\n          <textarea {...bindContent} name='content' type=\"textarea\" className={styles.formTextArea}/>\n        </div>\n        {/* <div style={{height:'10px',textAlign:'center'}}>\n          {userContext.error && !email && <span style={{color:'red'}}>Wrong email or password</span>}\n        </div> */}\n        <button className={styles.formSubmit}>Submit</button>\n      </form>\n    </div>\n  )\n}\n\nexport default Edit\n"]},"metadata":{},"sourceType":"module"}